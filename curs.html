<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <title>–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ú–æ–ª–¥–æ–≤—ã</title>
    <style>
        body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: auto;
        line-height: 1.6;
        }
        h1 {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 1rem;
        }
        h1 img {
        width: 202px;
        height: 50px;
        }
        h2 {
        margin-top: 40px;
        margin-bottom: 12px;
        }
        pre {
        background: #f4f4f4;
        padding: 15px;
        border-radius: 5px;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: monospace;
        }
        .up {
        color: green;
        font-weight: bold;
        }
        .down {
        color: red;
        font-weight: bold;
        }
        .same {
        color: black;
        font-weight: normal;
        }
        button {
        margin-top: 10px;
        padding: 8px 16px;
        cursor: pointer;
        font-size: 16px;
        }
        table {
        margin: 15px auto 40px auto;
        border-collapse: collapse;
        width: auto;
        min-width: 320px;
        }
        th, td {
        border: 1px solid #ddd;
        padding: 8px 12px;
        text-align: center;
        }
        th {
        background: #f0f0f0;
        }
        .diff {
        font-weight: bold;
        }
        .diff.up {
        color: green;
        }
        .diff.down {
        color: red;
        }
        .diff.same {
        color: black;
        font-weight: normal;
        }
    </style>
</head>
<body>
<h1>
    <img loading="lazy" width="202" height="50" src="https://bas-tv.md/wp-content/uploads/2023/05/bas-tv-culoarea-rosie.png"
         alt="bas-tv logo"/>
    –ö—É—Ä—Å—ã –≤–∞–ª—é—Ç –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ú–æ–ª–¥–æ–≤—ã
</h1>
<button onclick="fetchRates()">üì• –ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å—ã</button>
<div id="content-ru" style="margin-top: 20px;"></div>
<div id="content-ro"></div>
<script>
    const flags = {
      USD: 'https://flagcdn.com/us.svg',
      EUR: 'https://flagcdn.com/eu.svg',
      RUB: 'https://flagcdn.com/ru.svg',
      RON: 'https://flagcdn.com/ro.svg',
      UAH: 'https://flagcdn.com/ua.svg',
    };

    function formatDateObjToString(d) {
      return `${d.getDate().toString().padStart(2,'0')}.${(d.getMonth()+1).toString().padStart(2,'0')}.${d.getFullYear()}`;
    }
    function formatISODate(d) {
      return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getDate().toString().padStart(2,'0')}`;
    }
    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    async function fetchWithRetries(url, attempts = 5, delayMs = 2000) {
      for(let i=0; i<attempts; i++){
        try {
          const res = await fetch(url);
          if(res.ok) return await res.text();
        } catch {}
        if(i < attempts - 1) await delay(delayMs);
      }
      throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ø—ã—Ç–æ–∫');
    }
    const codes = ['USD','EUR','RUB','RON','UAH'];

    function phraseRU(code, diff){
      const absDiff = Math.abs(diff);
      const roundedBani = Math.round(absDiff * 100);

      if (diff === 0) {
        const noChangePhrases = {
          USD: '–î–æ–ª–ª–∞—Ä –°–®–ê –æ—Å—Ç–∞–ª—Å—è –Ω–∞ –ø—Ä–µ–∂–Ω–µ–º —É—Ä–æ–≤–Ω–µ',
          EUR: '–ï–≤—Ä–æ –æ—Å—Ç–∞–ª—Å—è –Ω–∞ –ø—Ä–µ–∂–Ω–µ–º —É—Ä–æ–≤–Ω–µ',
          RUB: '–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å –æ—Å—Ç–∞–ª—Å—è –Ω–∞ –ø—Ä–µ–∂–Ω–µ–º —É—Ä–æ–≤–Ω–µ',
          RON: '–†—É–º—ã–Ω—Å–∫–∏–π –ª–µ–π –æ—Å—Ç–∞–ª—Å—è –Ω–∞ –ø—Ä–µ–∂–Ω–µ–º —É—Ä–æ–≤–Ω–µ',
          UAH: '–£–∫—Ä–∞–∏–Ω—Å–∫–∞—è –≥—Ä–∏–≤–Ω–∞ –æ—Å—Ç–∞–ª–∞—Å—å –Ω–∞ –ø—Ä–µ–∂–Ω–µ–º —É—Ä–æ–≤–Ω–µ'
        };
        return noChangePhrases[code] || `${code} –æ—Å—Ç–∞–ª–∞—Å—å –Ω–∞ –ø—Ä–µ–∂–Ω–µ–º —É—Ä–æ–≤–Ω–µ`;
      }

      function declOfNum(n) {
        const lastTwo = n % 100;
        if (lastTwo >= 11 && lastTwo <= 14) return '–±–∞–Ω–æ–≤';
        const last = n % 10;
        if (last === 1) return '–±–∞–Ω';
        if (last >= 2 && last <= 4) return '–±–∞–Ω–∞';
        return '–±–∞–Ω–æ–≤';
      }

      const startPhrases = {
        USD: '–î–æ–ª–ª–∞—Ä –°–®–ê',
        EUR: '–ï–≤—Ä–æ',
        RUB: '–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å',
        RON: '–†—É–º—ã–Ω—Å–∫–∏–π –ª–µ–π',
        UAH: '–£–∫—Ä–∞–∏–Ω—Å–∫–∞—è –≥—Ä–∏–≤–Ω–∞'
      };

      const base = startPhrases[code] || code;

      const choose = (arr) => arr[Math.floor(Math.random() * arr.length)];

    const endingsUp = {
      slight: {
        default: [
          '—Å–ª–µ–≥–∫–∞ –≤—ã—Ä–æ—Å',
          '–Ω–µ–º–Ω–æ–≥–æ —É–∫—Ä–µ–ø–∏–ª—Å—è',
          '- –Ω–µ–±–æ–ª—å—à–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫—É—Ä—Å–∞',
          '–ø–æ–∫–∞–∑–∞–ª –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç',
          '—á—É—Ç—å-—á—É—Ç—å –ø–æ–¥–æ—Ä–æ–∂–∞–ª',
          '–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –ª—ë–≥–∫–∏–π –ø–æ–¥—ä—ë–º',
          '–æ—Ç–º–µ—Ç–∏–ª—Å—è —Å–ª–∞–±—ã–º —Ä–æ—Å—Ç–æ–º'
        ],
        UAH: [
          '—Å–ª–µ–≥–∫–∞ –≤—ã—Ä–æ—Å–ª–∞',
          '–Ω–µ–º–Ω–æ–≥–æ —É–∫—Ä–µ–ø–∏–ª–∞—Å—å',
          '–ø–æ–∫–∞–∑–∞–ª–∞ –Ω–µ–±–æ–ª—å—à–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ',
          '–æ—Ç–º–µ—Ç–∏–ª–∞—Å—å –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º —Ä–æ—Å—Ç–æ–º',
          '—á—É—Ç—å-—á—É—Ç—å –ø–æ–¥–æ—Ä–æ–∂–∞–ª–∞',
          '–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∞ –ª—ë–≥–∫–∏–π –ø–æ–¥—ä—ë–º',
          '–ø–æ–∫–∞–∑–∞–ª–∞ —Å–ª–∞–±—ã–π —Ä–æ—Å—Ç'
        ]
      },
      moderate: (amount, code) => {
        if (code === 'UAH') {
          return [
            `—É–≤–µ–ª–∏—á–∏–ª–∞—Å—å –Ω–∞ ${amount}`,
            `–ø–æ–¥–Ω—è–ª–∞—Å—å –Ω–∞ ${amount}`,
            `–ø–æ–∫–∞–∑–∞–ª–∞ —Ä–æ—Å—Ç –Ω–∞ ${amount}`,
            `—É–∫—Ä–µ–ø–∏–ª–∞—Å—å –Ω–∞ ${amount}`,
            `–ø—Ä–∏—Ä–æ—Å–ª–∞ –Ω–∞ ${amount}`,
            `–æ–±–Ω–æ–≤–∏–ª–∞ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø—Ä–∏–±–∞–≤–∏–≤ ${amount}`
          ];
        }
        return [
          `—É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ ${amount}`,
          `–ø–æ–¥–Ω—è–ª—Å—è –Ω–∞ ${amount}`,
          `–ø–æ–∫–∞–∑–∞–ª —Ä–æ—Å—Ç –Ω–∞ ${amount}`,
          `—É–∫—Ä–µ–ø–∏–ª—Å—è –Ω–∞ ${amount}`,
          `–ø—Ä–∏—Ä–æ—Å –Ω–∞ ${amount}`,
          `–æ–±–Ω–æ–≤–∏–ª –∑–Ω–∞—á–µ–Ω–∏–µ, –ø—Ä–∏–±–∞–≤–∏–≤ ${amount}`
        ];
      },
      significant: (amount, code) => {
        if (code === 'UAH') {
          return [
            `–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–∫—Ä–µ–ø–∏–ª–∞—Å—å, —É–≤–µ–ª–∏—á–∏–≤—à–∏—Å—å –Ω–∞ ${amount}`,
            `—Å–∏–ª—å–Ω–æ –≤—ã—Ä–æ—Å–ª–∞, –ø—Ä–∏–±–∞–≤–∏–≤ ${amount}`,
            `–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç ‚Äî +${amount}`,
            `–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∞ —Ä–µ–∑–∫–∏–π –ø–æ–¥—ä—ë–º –Ω–∞ ${amount}`,
            `—Å—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ ${amount}`,
            `- –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —É–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–∫–∞—á–æ–∫ ‚Äî +${amount}`
          ];
        }
        return [
          `–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–∫—Ä–µ–ø–∏–ª—Å—è, —É–≤–µ–ª–∏—á–∏–≤—à–∏—Å—å –Ω–∞ ${amount}`,
          `—Å–∏–ª—å–Ω–æ –≤—ã—Ä–æ—Å, –ø—Ä–∏–±–∞–≤–∏–≤ ${amount}`,
          `–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç ‚Äî +${amount}`,
          `–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª —Ä–µ–∑–∫–∏–π –ø–æ–¥—ä—ë–º –Ω–∞ ${amount}`,
          `—Å—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Ä–æ—Å –Ω–∞ ${amount}`,
          `- –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —É–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–∫–∞—á–æ–∫ ‚Äî +${amount}`
        ];
      }
    };

      const endingsDown = {
        slight: {
      default: [
        '—Å–ª–µ–≥–∫–∞ —Å–Ω–∏–∑–∏–ª—Å—è',
        '–Ω–µ–º–Ω–æ–≥–æ –æ—Å–ª–∞–±',
        '–Ω–µ–±–æ–ª—å—à–æ–µ –ø–æ–Ω–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞',
        '–ø–æ–∫–∞–∑–∞–ª —Å–ª–∞–±–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ',
        '—á—É—Ç—å-—á—É—Ç—å –ø–æ–¥–µ—à–µ–≤–µ–ª',
        '–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –ª—ë–≥–∫–æ–µ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ',
        '–æ—Ç–º–µ—Ç–∏–ª—Å—è –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º —Å–Ω–∏–∂–µ–Ω–∏–µ–º'
      ],
      UAH: [
        '—Å–ª–µ–≥–∫–∞ —Å–Ω–∏–∑–∏–ª–∞—Å—å',
        '–Ω–µ–º–Ω–æ–≥–æ –æ—Å–ª–∞–±–ª–∞',
        '–ø–æ–∫–∞–∑–∞–ª–∞ –Ω–µ–±–æ–ª—å—à–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ',
        '–æ—Ç–º–µ—Ç–∏–ª–∞—Å—å –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º —Å–Ω–∏–∂–µ–Ω–∏–µ–º',
        '—á—É—Ç—å-—á—É—Ç—å –ø–æ–¥–µ—à–µ–≤–µ–ª–∞',
        '–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∞ –ª—ë–≥–∫–æ–µ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ',
        '–ø–æ–∫–∞–∑–∞–ª–∞ —Å–ª–∞–±–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ'
      ],
      RUB: [
        '–ø–æ–∫–∞–∑–∞–ª –Ω–µ–±–æ–ª—å—à–æ–µ –ø–æ–Ω–∏–∂–µ–Ω–∏–µ –∫—É—Ä—Å–∞',
        '—Å–ª–µ–≥–∫–∞ —Å–Ω–∏–∑–∏–ª—Å—è',
        '–Ω–µ–º–Ω–æ–≥–æ –æ—Å–ª–∞–±',
        '–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –ª—ë–≥–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ',
        '—á—É—Ç—å-—á—É—Ç—å –ø–æ–¥–µ—à–µ–≤–µ–ª',
        '–æ—Ç–º–µ—Ç–∏–ª—Å—è –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º —Å–Ω–∏–∂–µ–Ω–∏–µ–º'
      ]
    },
       moderate: (amount, code) => {
      if (code === 'UAH') return [
        `—É–º–µ–Ω—å—à–∏–ª–∞—Å—å –Ω–∞ ${amount}`,
        `- –ø–∞–¥–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –Ω–∞ ${amount}`,
        `–ø–æ–∫–∞–∑–∞–ª–∞ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ ${amount}`,
        `–æ—Å–ª–∞–±–ª–∞ –Ω–∞ ${amount}`,
        `–ø–æ–¥–µ—à–µ–≤–µ–ª–∞ –Ω–∞ ${amount}`,
        `–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∞ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ ${amount}`
      ];
      return [
        `—É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ ${amount}`,
        `- –ø–∞–¥–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –Ω–∞ ${amount}`,
        `–ø–æ–∫–∞–∑–∞–ª —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ ${amount}`,
        `–æ—Å–ª–∞–± –Ω–∞ ${amount}`,
        `–ø–æ–¥–µ—à–µ–≤–µ–ª –Ω–∞ ${amount}`,
        `–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ ${amount}`
      ];
    },
        significant: (amount, code) => {
      if (code === 'UAH') return [
        `–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Å–ª–∞–±–ª–∞, —É–º–µ–Ω—å—à–∏–≤—à–∏—Å—å –Ω–∞ ${amount}`,
        `—Å–∏–ª—å–Ω–æ —Å–Ω–∏–∑–∏–ª–∞—Å—å, –ø–æ—Ç–µ—Ä—è–≤ ${amount}`,
        `–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ ‚Äî -${amount}`,
        `–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∞ —Ä–µ–∑–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ –Ω–∞ ${amount}`,
        `—Å—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∑–∏–ª–∞—Å—å –Ω–∞ ${amount}`,
        `–Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–µ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ ‚Äî -${amount}`
      ];
      return [
        `–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Å–ª–∞–±, —É–º–µ–Ω—å—à–∏–≤—à–∏—Å—å –Ω–∞ ${amount}`,
        `—Å–∏–ª—å–Ω–æ —Å–Ω–∏–∑–∏–ª—Å—è, –ø–æ—Ç–µ—Ä—è–≤ ${amount}`,
        `–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ ‚Äî -${amount}`,
        `–ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª —Ä–µ–∑–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ –Ω–∞ ${amount}`,
        `—Å—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∑–∏–ª—Å—è –Ω–∞ ${amount}`,
        `–Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–µ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ ‚Äî -${amount}`
      ];
    }
      };

      let endingPhrase = '';

    if (roundedBani < 1) {
      if (diff > 0) {
        if (code === 'UAH') endingPhrase = choose(endingsUp.slight.UAH);
        else endingPhrase = choose(endingsUp.slight.default);
      } else {
        if (code === 'UAH') endingPhrase = choose(endingsDown.slight.UAH);
        else if (code === 'RUB') endingPhrase = choose(endingsDown.slight.RUB);
        else endingPhrase = choose(endingsDown.slight.default);
      }
      } else if (roundedBani < 95) {
        const amount = `${roundedBani} ${declOfNum(roundedBani)}`;
        if (diff > 0) {
          endingPhrase = choose(endingsUp.moderate(amount));
        } else {
          endingPhrase = choose(endingsDown.moderate(amount, code));
        }
      } else {
        const lei = Math.floor(roundedBani / 100);
        const bani = roundedBani % 100;
        let baniStr = '';
        if (bani > 0) {
          baniStr = ` –∏ ${bani} ${declOfNum(bani)}`;
        }
        const amount = `${lei} –ª–µ–π${baniStr}`;
        if (diff > 0) {
          endingPhrase = choose(endingsUp.significant(amount));
        } else {
          endingPhrase = choose(endingsDown.significant(amount, code));
        }
      }

      return `${base} ${endingPhrase}`;
    }

    function phraseRO(code, diff) {
      const absDiff = Math.abs(diff);
      const roundedBani = Math.round(absDiff * 100);

      if (diff === 0) {
        const noChangePhrases = {
          USD: 'Dolarul american a rƒÉmas la acela»ôi nivel',
          EUR: 'Euro a rƒÉmas la acela»ôi nivel',
          RUB: 'Rubla rusƒÉ a rƒÉmas la acela»ôi nivel',
          RON: 'Leul rom√¢nesc a rƒÉmas la acela»ôi nivel',
          UAH: 'Grivna ucraineanƒÉ a rƒÉmas la acela»ôi nivel'
        };
        return noChangePhrases[code] || `${code} a rƒÉmas la acela»ôi nivel`;
      }

      function declOfNum(n) {
        return n === 1 ? 'ban' : 'bani';
      }

      const basePhrases = {
        USD: 'Dolarul american',
        EUR: 'Euro',
        RUB: 'Rubla rusƒÉ',
        RON: 'Leul rom√¢nesc',
        UAH: 'Grivna ucraineanƒÉ'
      };

      const base = basePhrases[code] || code;

      const choose = (arr) => arr[Math.floor(Math.random() * arr.length)];

      const endingsUp = {
        slight: {
          default: [
            'a crescut u»ôor',
            'a √Ænregistrat o cre»ôtere micƒÉ',
            'a avansat pu»õin',
            'a arƒÉtat un u»ôor avans',
            'a urcat pu»õin'
          ]
        },
        moderate: (amount) => [
          `a crescut cu ${amount}`,
          `a avansat cu ${amount}`,
          `a √Ænregistrat o cre»ôtere de ${amount}`
        ],
        significant: (amount) => [
          `a crescut semnificativ, cu ${amount}`,
          `a √Ænregistrat o cre»ôtere puternicƒÉ de ${amount}`,
          `a avansat considerabil ‚Äî +${amount}`
        ]
      };

      const endingsDown = {
        slight: {
          default: [
            'a scƒÉzut u»ôor',
            'a √Ænregistrat o scƒÉdere micƒÉ',
            'a pierdut pu»õin teren',
            'a arƒÉtat un declin u»ôor',
            'a cobor√¢t pu»õin'
          ]
        },
        moderate: (amount) => [
          `a scƒÉzut cu ${amount}`,
          `a pierdut ${amount}`,
          `a √Ænregistrat o scƒÉdere de ${amount}`
        ],
        significant: (amount) => [
          `a scƒÉzut semnificativ, cu ${amount}`,
          `a pierdut puternic ‚Äî ${amount}`,
          `a √Ænregistrat o scƒÉdere considerabilƒÉ de ${amount}`
        ]
      };

      let changeText = '';

      if (roundedBani < 1) {
        changeText = diff > 0
          ? choose(endingsUp.slight.default)
          : choose(endingsDown.slight.default);
      } else if (roundedBani < 100) {
        const amount = `${roundedBani} ${declOfNum(roundedBani)}`;
        changeText = diff > 0
          ? choose(endingsUp.moderate(amount))
          : choose(endingsDown.moderate(amount));
      } else {
        const lei = Math.floor(roundedBani / 100);
        const bani = roundedBani % 100;
        let baniStr = '';
        if (bani > 0) {
          baniStr = ` »ôi ${bani} ${declOfNum(bani)}`;
        }
        const amount = `${lei} leu${lei > 1 ? 'i' : ''}${baniStr}`;
        changeText = diff > 0
          ? choose(endingsUp.significant(amount))
          : choose(endingsDown.significant(amount));
      }

      return `${base} ${changeText}`;
    }

    function parseRates(xml){
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xml,'text/xml');
      const result = {};
      codes.forEach(code => {
        const valute = [...xmlDoc.querySelectorAll('Valute')].find(v => v.querySelector('CharCode')?.textContent === code);
        if(valute){
          const nominal = parseFloat(valute.querySelector('Nominal').textContent);
          const value = parseFloat(valute.querySelector('Value').textContent.replace(',', '.'));
          result[code] = value / nominal;
        }
      });
      return result;
    }

    function createHtmlNews(ratesT, ratesY, phraseFunc, lang, currentDate) {
      const container = document.createElement('div');
      const dateISO = formatISODate(currentDate);
      const dateShow = formatDateObjToString(currentDate);

      const title = document.createElement('h2');
      title.textContent = lang === 'ru'
        ? '–î–∏–Ω–∞–º–∏–∫–∞ –≤–∞–ª—é—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ú–æ–ª–¥–æ–≤—ã –Ω–∞ ' + dateISO
        : 'Dinamica cursurilor valutare ale BƒÉncii Na»õionale a Moldovei la ' + dateISO;
      container.appendChild(title);

      const introP = document.createElement('p');
      introP.style.marginBottom = '0.5em';
      introP.textContent = lang === 'ru'
        ? `–°–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ú–æ–ª–¥–æ–≤—ã –Ω–∞ ${dateShow}:`
        : `Conform datelor oficiale ale BƒÉncii Na»õionale a Moldovei la data de ${dateShow}:`;
      container.appendChild(introP);

    let anyChanges = false;
    const ul = document.createElement('ul');

    codes.forEach(code => {
      if(ratesT[code] === undefined) return;
      const curr = ratesT[code];
      const prev = ratesY[code] ?? curr;
      const diff = curr - prev;

      if(diff !== 0){
        anyChanges = true;
      }
    });

    if(anyChanges){
      codes.forEach(code => {
        if(ratesT[code] === undefined) return;
        const curr = ratesT[code];
        const prev = ratesY[code] ?? curr;
        const diff = curr - prev;
        const li = document.createElement('li');
        li.textContent = phraseFunc(code, diff);
        ul.appendChild(li);
      });
      container.appendChild(ul);
    }


      const table = document.createElement('table');
      const thead = document.createElement('thead');

      const changesExist = codes.some(code => {
        if(ratesT[code] === undefined) return false;
        const diff = ratesT[code] - (ratesY[code] ?? ratesT[code]);
        return diff !== 0;
      });

      if(lang === 'ru'){
        thead.innerHTML = changesExist
          ? `<tr><th>–í–∞–ª—é—Ç–∞</th><th>–ö—É—Ä—Å (MDL)</th><th>–ò–∑–º–µ–Ω–µ–Ω–∏–µ</th></tr>`
          : `<tr><th>–í–∞–ª—é—Ç–∞</th><th>–ö—É—Ä—Å (MDL)</th></tr>`;
      } else {
        thead.innerHTML = changesExist
          ? `<tr><th>Valuta</th><th>Curs (MDL)</th><th>Modificare</th></tr>`
          : `<tr><th>Valuta</th><th>Curs (MDL)</th></tr>`;
      }
      table.appendChild(thead);

      const tbody = document.createElement('tbody');

      codes.forEach(code => {
        if(ratesT[code] === undefined) return;
        const curr = ratesT[code];
        const prev = ratesY[code] ?? curr;
        const diff = curr - prev;

        let diffClass, diffStr;
        if(diff > 0){
          diffClass = 'up';
          diffStr = `+${diff.toFixed(4)}`;
        } else if(diff < 0){
          diffClass = 'down';
          diffStr = diff.toFixed(4);
        } else {
          diffClass = 'same';
          diffStr = '0.0000';
        }

        const tr = document.createElement('tr');

        const flagUrl = flags[code] || '';
    const flagImg = flagUrl
      ? `<img src="${flagUrl}" alt="${code}" style="width:24px; height:16px; vertical-align:middle; margin-right:6px;">`
      : '';

        if(changesExist){
          tr.innerHTML = `
            <td>${flagImg}${code}</td>
            <td>${curr.toFixed(4)}</td>
            <td class="diff ${diffClass}">${diffStr}</td>
          `;
        } else {
          tr.innerHTML = `
            <td>${flagImg}${code}</td>
            <td>${curr.toFixed(4)}</td>
          `;
        }

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      container.appendChild(table);

      const copyBtn = document.createElement('button');
      copyBtn.textContent = lang === 'ru' ? 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å' : 'üìã CopiazƒÉ';
      copyBtn.onclick = () => {
        const markdownText = buildMarkdown(dateISO, ratesT, ratesY, phraseFunc,
          lang === 'ru'
            ? `–°–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ú–æ–ª–¥–æ–≤—ã –Ω–∞ ${dateISO}:`
            : `Conform datelor oficiale ale BƒÉncii Na»õionale a Moldovei la data de ${dateISO}:`,
          lang === 'ro'
        );
        navigator.clipboard.writeText(markdownText)
          .catch(err => console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err));
      };
      container.appendChild(copyBtn);

      return container;
    }

    function buildMarkdown(dateISO, ratesT, ratesY, phraseFunc, langIntro, isRO) {
      const lines = [];
      let anyChange = false;

      codes.forEach(code => {
        if (ratesT[code] === undefined) return;

        const prevRate = ratesY[code] ?? ratesT[code];
        const diff = ratesT[code] - prevRate;

        if (diff !== 0) {
          lines.push(phraseFunc(code, diff));
          anyChange = true;
        }
      });

    let md = `# ${isRO
      ? 'Dinamica cursurilor valutare ale BƒÉncii Na»õionale a Moldovei la'
      : '–î–∏–Ω–∞–º–∏–∫–∞ –≤–∞–ª—é—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –ú–æ–ª–¥–æ–≤—ã –Ω–∞'} ${dateISO}\n\n${langIntro}\n`;


    md+='\n';

      if (anyChange) {
        md += lines.map(line => `‚Ä¢ ${line}`).join('\n') + '\n\n';
      }

      if (anyChange) {
        md += isRO
          ? `| Valuta | Curs (MDL) | Modificare |\n|--------|------------|------------|\n`
          : `| –í–∞–ª—é—Ç–∞ | –ö—É—Ä—Å (MDL) | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |\n|--------|------------|-----------|\n`;

        codes.forEach(code => {
          if (ratesT[code] === undefined) return;
          const curr = ratesT[code];
          const prev = ratesY[code] ?? curr;
          const diff = curr - prev;

          let diffVal = '0.0000';

          if (diff > 0) {
            diffVal = `+${diff.toFixed(4)}`;
          } else if (diff < 0) {
            diffVal = diff.toFixed(4);
          }

          md += `| ${code} | ${curr.toFixed(4)} | ${diffVal} |\n`;
        });
      } else {
        md += isRO
          ? `| Valuta | Curs (MDL) |\n|--------|------------|\n`
          : `| –í–∞–ª—é—Ç–∞ | –ö—É—Ä—Å (MDL) |\n|--------|------------|\n`;

        codes.forEach(code => {
          if (ratesT[code] === undefined) return;
          md += `| ${code} | ${ratesT[code].toFixed(4)} |\n`;
        });
      }

      return md;
    }


    async function fetchRates() {
      const dateInput = prompt('–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É (–ì–ì–ì–ì-–ú–ú-–î–î):', new Date().toISOString().slice(0,10));
      if (!dateInput) return;

      const [y, m, d] = dateInput.split('-');
      const currentDate = new Date(+y, +m - 1, +d);

      const prevDate = new Date(currentDate);
      prevDate.setDate(currentDate.getDate() - 1);

      const dateStr1 = formatDateObjToString(currentDate);
      const dateStr2 = formatDateObjToString(prevDate);

      const dateISO1 = formatISODate(currentDate);
      const dateShow1 = formatDateObjToString(currentDate);

      const url1 = `https://api.allorigins.win/raw?url=${encodeURIComponent('https://www.bnm.md/en/official_exchange_rates?get_xml=1&date=' + dateStr1)}`;
      const url2 = `https://api.allorigins.win/raw?url=${encodeURIComponent('https://www.bnm.md/en/official_exchange_rates?get_xml=1&date=' + dateStr2)}`;

      const containerRU = document.getElementById('content-ru');
      const containerRO = document.getElementById('content-ro');

      containerRU.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
      containerRO.innerHTML = '';

      try {
        const [xml1, xml2] = await Promise.all([
          fetchWithRetries(url1),
          fetchWithRetries(url2)
        ]);

        const ratesToday = parseRates(xml1);
        const ratesYesterday = parseRates(xml2);

        containerRU.innerHTML = '';
        containerRO.innerHTML = '';

    containerRU.appendChild(createHtmlNews(ratesToday, ratesYesterday, phraseRU, 'ru', currentDate));
    containerRO.appendChild(createHtmlNews(ratesToday, ratesYesterday, phraseRO, 'ro', currentDate));

    
      } catch (e) {
        containerRU.innerHTML = `<p style="color:red;">–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>`;
        containerRO.innerHTML = '';
        console.error(e);
      }
    }

</script>
</body>
</html>